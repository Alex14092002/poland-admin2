<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>CROPPED - Bootstrap 5 Admin Template</title>
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <meta content="" name="keywords" />
    <meta content="" name="description" />

    <!-- Favicon -->
    <link href="img/favicon.ico" rel="icon" />
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-storage.js"></script>
    <!-- Google Web Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600&family=Roboto:wght@500;700&display=swap"
      rel="stylesheet"
    />

    <!-- Icon Font Stylesheet -->
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.0/css/all.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.1/font/bootstrap-icons.css"
      rel="stylesheet"
    />

    <!-- Libraries Stylesheet -->
    <link href="lib/owlcarousel/assets/owl.carousel.min.css" rel="stylesheet" />
    <link
      href="lib/tempusdominus/css/tempusdominus-bootstrap-4.min.css"
      rel="stylesheet"
    />

    <!-- Customized Bootstrap Stylesheet -->
    <link href="css/bootstrap.min.css" rel="stylesheet" />

    <!-- Template Stylesheet -->
    <link href="css/style.css" rel="stylesheet" />
    <style>
      .content {
        color: #fff !important;
        padding-top: 20px;
      }
      .item-edit input {
        width: 80%;
        margin-left: 20px;
      }
      .item-edit {
        display: flex;
        text-align: center;
        justify-content: center;
        margin-bottom: 30px;
      }
      .textarea {
        display: flex;
        justify-content: center;
        align-items: center;
      }
      .textarea label {
        margin-right: 20px;
      }
      .btn-upload {
        display: flex;
        justify-content: center;
      }
      .btn-upload button {
        padding: 10px 30px;
        font-size: 18px;
        border: none;
        background-color: red;
        color: #fff;
        box-shadow: 0 0 1px 1px #fff;
      }
    </style>
  </head>

  <body>
    <div class="container-fluid position-relative d-flex p-0">
      <!-- Spinner Start -->
      <div
        id="spinner"
        class="show bg-dark position-fixed translate-middle w-100 vh-100 top-50 start-50 d-flex align-items-center justify-content-center"
      >
        <div
          class="spinner-border text-primary"
          style="width: 3rem; height: 3rem"
          role="status"
        >
          <span class="sr-only">Loading...</span>
        </div>
      </div>
      <!-- Spinner End -->

      <!-- Sidebar Start -->
      <div class="sidebar pe-4 pb-3">
        <nav class="navbar bg-secondary navbar-dark">
          <a href="index.html" class="navbar-brand mx-4 mb-3">
            <h3 class="text-primary">
              <i class="fa fa-user-edit me-2"></i>CROPPED
            </h3>
          </a>
          <div class="d-flex align-items-center ms-4 mb-4">
            <div class="position-relative">
              <img
                class="rounded-circle"
                src="img/logov3.webp"
                alt=""
                style="width: 40px; height: 40px"
              />
              <div
                class="bg-success rounded-circle border border-2 border-white position-absolute end-0 bottom-0 p-1"
              ></div>
            </div>
            <div class="ms-3">
              <h6 class="mb-0">Jhon Doe</h6>
              <span>Admin</span>
            </div>
          </div>
          <div class="navbar-nav w-100">
            <a href="index.html" class="nav-item nav-link"
              ><i class="fa fa-tachometer-alt me-2"></i>Trang Chủ</a
            >
            <a href="order.html" class="nav-item nav-link"
              ><i class="fa fa-th me-2"></i>Đơn Hàng</a
            >
            <a
              href="./product.html?id_catelory=akcesorie"
              class="nav-item nav-link"
              ><i class="fa fa-keyboard me-2"></i>akcesorie</a
            >
            <a
              href="./product.html?id_catelory=baterie"
              class="nav-item nav-link"
              ><i class="fa fa-keyboard me-2"></i>baterie</a
            >
            <a
              href="./product.html?id_catelory=budzik"
              class="nav-item nav-link"
              ><i class="fa fa-keyboard me-2"></i>budzik</a
            >
            <a
              href="./product.html?id_catelory=czajnik"
              class="nav-item nav-link"
              ><i class="fa fa-keyboard me-2"></i>czajnik</a
            >
            <a
              href="./product.html?id_catelory=garnki"
              class="nav-item nav-link"
              ><i class="fa fa-keyboard me-2"></i>garnki</a
            >
            <a href="./product.html?id_catelory=gaz" class="nav-item nav-link"
              ><i class="fa fa-keyboard me-2"></i>gaz</a
            >
            <a
              href="./product.html?id_catelory=golarka"
              class="nav-item nav-link"
              ><i class="fa fa-keyboard me-2"></i>golarka</a
            >
            <a
              href="./product.html?id_catelory=kuchenka"
              class="nav-item nav-link"
              ><i class="fa fa-keyboard me-2"></i>kuchenka</a
            >
            <a href="./product.html?id_catelory=lampa" class="nav-item nav-link"
              ><i class="fa fa-keyboard me-2"></i>lampa</a
            >
            <a
              href="./product.html?id_catelory=latarka"
              class="nav-item nav-link"
              ><i class="fa fa-keyboard me-2"></i>latarka</a
            >
            <a
              href="./product.html?id_catelory=najlepsza_wyprzedaz"
              class="nav-item nav-link"
              ><i class="fa fa-keyboard me-2"></i>najlepsza_wyprzedaz</a
            >
            <a
              href="./product.html?id_catelory=nozycki"
              class="nav-item nav-link"
              ><i class="fa fa-keyboard me-2"></i>nozycki</a
            >
            <a
              href="./product.html?id_catelory=obuwie"
              class="nav-item nav-link"
              ><i class="fa fa-keyboard me-2"></i>obuwie</a
            >
            <a
              href="./product.html?id_catelory=parasol"
              class="nav-item nav-link"
              ><i class="fa fa-keyboard me-2"></i>parasol</a
            >
            <a
              href="./product.html?id_catelory=patelnia"
              class="nav-item nav-link"
              ><i class="fa fa-keyboard me-2"></i>patelnia</a
            >
            <a href="./product.html?id_catelory=radio" class="nav-item nav-link"
              ><i class="fa fa-keyboard me-2"></i>radio</a
            >
            <a
              href="./product.html?id_catelory=suszarka"
              class="nav-item nav-link"
              ><i class="fa fa-keyboard me-2"></i>suszarka</a
            >
            <a
              href="./product.html?id_catelory=thermos"
              class="nav-item nav-link"
              ><i class="fa fa-keyboard me-2"></i>thermos</a
            >
            <a
              href="./product.html?id_catelory=wentylator"
              class="nav-item nav-link"
              ><i class="fa fa-keyboard me-2"></i>wentylator</a
            >
            <a
              href="./product.html?id_catelory=zabawka"
              class="nav-item nav-link"
              ><i class="fa fa-keyboard me-2"></i>zabawka</a
            >
            <a
              href="./product.html?id_catelory=zelarko"
              class="nav-item nav-link"
              ><i class="fa fa-keyboard me-2"></i>zelarko</a
            >
            <a
              href="./product.html?id_catelory=sanphammoi"
              class="nav-item nav-link"
              ><i class="fa fa-keyboard me-2"></i>Sản Phẩm Mới</a
            >
            <a href="./email.html" class="nav-item nav-link"
              ><i class="fa fa-keyboard me-2"></i>Email</a
            >
          </div>
        </nav>
      </div>
      <!-- Sidebar End -->

      <!-- Content Start -->
      <div class="content container">
        <div class="row">
          <div class="col-4 item-edit">
            <label for="name">Name :</label>
            <input type="text" id="name" placeholder="Enter name product" />
          </div>
          <div class="col-4 item-edit">
            <label for="img1">Img1 :</label>
            <div class="img1"></div>
            <input type="file" id="img1" accept="image/*" />
          </div>
          <div class="col-4 item-edit">
            <label for="img2">Img2 :</label>
            <div class="img2"></div>
            <input type="file" id="img2" accept="image/*" />
            <img src="" id="preview-img2" alt="" />
          </div>
          <div class="col-4 item-edit">
            <label for="img3">Img3 :</label>
            <div class="img3"></div>
            <input type="file" id="img3" accept="image/*" />
            <img src="" id="preview-img3" alt="" />
          </div>
          <div class="col-4 item-edit">
            <label for="img4">Img4 :</label>
            <div class="img4"></div>
            <input type="file" id="img4" accept="image/*" />
            <img src="" id="preview-img4" alt="" />
          </div>
          <div class="col-4 item-edit">
            <label for="img5">Img5 :</label>
            <div class="img5"></div>
            <input type="file" id="img5" accept="image/*" />
            <img src="" id="preview-img5" alt="" />
          </div>
          <div class="col-4 item-edit">
            <label for="price">Price Netto:</label>
            <input type="text" id="price" placeholder="Enter name price" />
          </div>
          <div class="col-4 item-edit">
            <label for="price2">Price Brutto:</label>
            <input type="text" id="price2" placeholder="Enter name price" />
          </div>
          <div class="col-4 item-edit">
            <label for="type">Đơn vị tính:</label>
            <input type="text" id="type" placeholder="Enter name type" />
          </div>
        </div>
        <div class="col-12 item-edit textarea">
          <label for="">Describe :</label>
          <textarea name="" id="describe" cols="100%" rows="5"></textarea>
        </div>
        <div class="btn-upload">
          <button class="btnMain">Update</button>
        </div>
      </div>
      <!-- Content End -->

      <!-- Back to Top -->
      <a href="#" class="btn btn-lg btn-primary btn-lg-square back-to-top"
        ><i class="bi bi-arrow-up"></i
      ></a>
    </div>

    <!-- JavaScript Libraries -->
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="lib/chart/chart.min.js"></script>
    <script src="lib/easing/easing.min.js"></script>
    <script src="lib/waypoints/waypoints.min.js"></script>
    <script src="lib/owlcarousel/owl.carousel.min.js"></script>
    <script src="lib/tempusdominus/js/moment.min.js"></script>
    <script src="lib/tempusdominus/js/moment-timezone.min.js"></script>
    <script src="lib/tempusdominus/js/tempusdominus-bootstrap-4.min.js"></script>

    <!-- Template Javascript -->
    <script src="js/main.js"></script>

    <script>
      const firebaseConfig = {
        apiKey: "AIzaSyDJeBM551vSoEfY9SIdVG_Y_G2JudH264I",
        authDomain: "db-ecomer-pola.firebaseapp.com",
        databaseURL: "https://db-ecomer-pola-default-rtdb.firebaseio.com",
        projectId: "db-ecomer-pola",
        storageBucket: "db-ecomer-pola.appspot.com",
        messagingSenderId: "826890256265",
        appId: "1:826890256265:web:10b474bb99fb5e1b11ab58",
      };
      // Khởi tạo Firebase
      firebase.initializeApp(firebaseConfig);
      
  let params = new URLSearchParams(location.search);
  let id = params.get("id");
  let id_catelory = params.get("id_catelory");
  console.log(id, id_catelory);

  const btn_update = document.querySelector(".btnMain");
  btn_update.onclick = () => {
    btn_update.disabled = true;
    const url = `https://db-ecomer-pola-default-rtdb.firebaseio.com/${id_catelory}/${id}.json`;

    const services = {
      name: document.querySelector("#name").value.trim(),
      price: document.querySelector("#price").value.trim(),
      describe: document.querySelector("#describe").value.trim(),
      price2: document.querySelector("#price2").value.trim(),
      type: document.querySelector("#type").value.trim(),
    };

    const images = {};

    const fileInputs = document.querySelectorAll('input[type="file"]');
    const storageRef = firebase.storage().ref();

    const uploadPromises = Array.from(fileInputs).map((input, index) => {
      const file = input.files[0];
      if (file) {
        const randomIndex = Math.random().toString(36).substring(2, 8);
        const imageRef = storageRef.child(
          `images/${id_catelory}/${id}/img${index + 1}_${randomIndex}`
        );
        return imageRef.put(file).then((snapshot) => {
          return snapshot.ref.getDownloadURL().then((downloadURL) => {
            images[`img${index + 1}`] = downloadURL;
          });
        });
      }
    });

    Promise.all(uploadPromises)
      .then(() => {
        const data = { ...services, ...images };
        const options = {
          method: "put",
          body: JSON.stringify(data),
          headers: { "Content-Type": "application/json" },
        };

        fetch(url, options)
          .then((res) => res.json())
          .then((data) => {
            document.location = `product.html?id_catelory=${id_catelory}`;
          })
          .catch((error) => {
            console.error(`Error updating product: ${error}`);
          });
      })
      .catch((error) => {
        console.error(`Error uploading images: ${error}`);
      });
  };

  const url = `https://db-ecomer-pola-default-rtdb.firebaseio.com/${id_catelory}/${id}.json`;
  fetch(url)
    .then((res) => res.json())
    .then((services) => {
      document.querySelector("#name").value = services.name;
      document.querySelector("#price").value = services.price;
      document.querySelector("#describe").value = services.describe;
      document.querySelector("#price2").value = services.price2;
      document.querySelector("#type").value = services.type;
    });
    </script>
  </body>
</html>
